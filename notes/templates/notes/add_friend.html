<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Friend</title>

  <script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
  crossorigin="anonymous"
></script>
<link
href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
rel="stylesheet"
integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
crossorigin="anonymous"
/>
<link
href="https://fonts.googleapis.com/css2?family=Reenie+Beanie&display=swap"
rel="stylesheet"
/>
    <style>
        body {
          margin: 0 auto;
          padding: 5px;
          text-align: center;
          background-color: #ffdfba;
          opacity: 0.7;
        }
        div {
          margin: 10px;
          padding: 1px;
        }
        body {
        font-family: "Reenie Beanie";
        font-size: 1.5rem;
      }
      </style>

  </head>
  <body>
    <form action="{% url 'add_friend' %}" method="post">
      {% csrf_token %}
      <div class="form-group">
        <input
          maxlength="10"
          required
          class="form-control form-control-lg"
          name="friend_username"
          type="text"
          placeholder="User ID"
        />
      </div>

      <input type="submit" class="btn btn-outline-dark" value="Search" "/>
      
    </form>
<br>
    {% if friend_username %}
    <span id= "friend_username"> {{friend_username}} <span/>
        {% if already_friend %}
          <button class="btn btn-outline-light" disabled>Already friend</button>
        {% elif received %}
          <button class='accept_friend btn btn-outline-light' data-with="{{friend_username}}">Accept</button>
        {% elif pending %}
          <button class="btn btn-outline-light" disabled>Already sent</button>
        {% else %}
          <button id="send_friend_request" type="submit" data-to-whom="{{friend_username}}">Send friend request</button>
        {% endif %}
{% elif not friend_username %}
{% if noID %}
<span style="color:red">No user under this id</span>
{% endif %}
{% endif %}

    <p><h1>New Requests</h1>
        {% if not my_request %}
        <span style="color:red">None</span> 
        {% endif %}
        {% for f in my_request %}
         <button class='accept_friend' data-with="{{f.from_user.username}}">{{f.from_user.username}}</button>
        {% endfor %}
    </p>

    <p><h1>Pending Request </h1>
        {% if not pending_request %}
        <span style="color:red"> None</span> 
        {% endif %}
        {% for pr in pending_request %}
          <button>{{pr.to_user.username}}</button>
        {% endfor %}
</p>

    <script>
        var fr = document.getElementById('send_friend_request')
        if (fr !=null){
            fr.addEventListener('click', function(event){
                window.location.href = "{% url 'send_friend_request'%}?friend_username="+this.getAttribute("data-to-whom");
            })

        }

        var af = document.getElementsByClassName('accept_friend')
        if (af!=null){
            for(var i =0;i<af.length;i++){
                af[i].addEventListener('click',accept_friend)
            }
        }


        function accept_friend(event){
            window.location.href= "{% url 'accept_friend' %}?with="+this.getAttribute('data-with')
        }
    </script>
  </body>
</html>
